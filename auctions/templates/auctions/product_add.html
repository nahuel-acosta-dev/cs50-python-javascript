{% extends "auctions/layout.html" %}


{% block body %}
<div class="card mb-3">
    <img src="{{ product.image }}" class="card-img-top" alt="image">
    <div class="card-body">
      <h5 class="card-title">$ {{ product.price }}</h5>
      <p class="card-text">{{ product.title }}</p>
      <div class="row">
        {% block form %}
          {% if user.is_authenticated %}
              <form class="col" action="{% url 'add_product' product.title %}" method="POST">
                {% csrf_token %}
                <div>
                  <button class="btn-link" type="submit" value="{{ user.username }}" name="button">Add to tracks</button>
                </div>
              </form>
          {% else %}
            <a class="col" href="{% url 'login' %}">Add to tracks</a>
          {% endif %}
        {% endblock %}
        {% if product.user == user %}
              <div class="col">
                {% if product.activate == False %}
                    {% if acquired == False %}
                    <a href="{% url 'activate_listing' product.id %}">Enable</a>
                    {% endif %}
                {% else %}
                <a href="{% url 'desactivate_listing' product.id %}">Disable</a>
                {% endif %}
              </div>
        {% endif %}
        {% if user.is_authenticated %}
              {% if product.user != user and product.activate == True %}
                  <form action="{% url 'new_ofert' product.id %}" method="POST">
                      {% csrf_token %}
                      <input type="number" min="{{ product.price }}" name="ofert">
                      <button class="btn btn-primary" type="submit">Ofert</button>
                  </form>
              {% endif %}
        {% endif %}
      </div>
      <div>
        <div><h3>Description</h3></div>
        <p class="card-text"><small class="text-muted">{{ product.description }}</small></p>
      </div>
      <div>
        <div><h3>Comments</h3></div>
        {% if user.is_authenticated %}
          <form action="{% url 'add_comment' product.title %}" method="POST">
            {% csrf_token %}
            <div class="row">
              <div class="col-1 input_number">
                <label for="calification">Calification</label>
                <input class="form-control" type="number" name="calification" id="calification" min="0" max="10">
              </div>
            </div>
              <div class="form-floating">
                <textarea name="comment" class="form-control" maxlength="150" minlength="1" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"></textarea>
                <label for="floatingTextarea2">Comments</label>
              </div>
            <div style="margin-top:5px;">
              <button class="btn btn-dark" type="submit" value="{{ user.username }}" name="button_comment">send</button>
            </div>
          </form>
        {% else %}
        <a href="{% url 'login' %}">Sign in to comment</a>
        {% endif %}
        {% for comment in comments %}
        <div class="card comments" style="width: 18rem;">
          <div class="card-body">
            <div class="row">
              <h5 class="card-title col">{{ comment.user}}</h5>
              {% if comment.user == user %}
              <form action="{% url 'delete_comment' product.title %}" method="POST" class="col">
                {% csrf_token %}
                <button class="btn btn-dark" type="submit" value="{{ comment.id }}" name="button_delete_comment">Delete</button>
              </form>
              {% endif %}
            </div>
            <p class="card-subtitle mb-2 text-muted" style="font-size: 10px">{{ comment.date|date:'Y/m/d H:i' }}</p>
            <p class="card-text">{{ comment.comment}}</p>
          </div>
        </div>
        {% empty %}
        <li>No comments.</li>
        {% endfor %}
      </div>
    </div>
  </div>
{% endblock %}